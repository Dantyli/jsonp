<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
     <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <title>jsonp跨域请求</title>
</head>
<body>
	<p>寻找属于你的声音</p>
	<input type="text" maxlength="11" id="search" placeholder="输入歌曲名或歌手名">
	<button id="btn">查询</button>
	<ol id="list"></ol>
</body>
<script>
//	$('#btn').on('click',function(){
//		var con=$('#search').val();
//		$.ajax({
//			url:'https://api.douban.com/v2/music/search',
//			dataType:'jsonp',
//			data:{q:con},
//			jsonp:'jsonpcallback',
//			success:function(data){
//				console.log(data)
//			}
//		});
//	})
	var listCon=document.querySelector('#list');
	var oBtn=document.getElementById('btn');
	function show(data,type){
		if(type=='n'){
			return 	typeof data=='undefined'?'--':data;
		}else{
			if(typeof data=='undefined'){
				return '--';
			}else{
				return data[0].name;
			}
		}
	}
	function mInfo(data){
		var data=data.musics;
		if(data.length>0){
			var list='<p>共为你搜到'+data.length+'条数据</p>'
			for(var i=0;i<data.length;i++){
				list+='<li><p><img src="'+data[i].image+'"></p><p>歌名:'+data[i].title+'</p><p>歌手:'+show(data[i].author,'nn')+'</p>';
				list+='<p>发布时间:'+show(data[i].attrs.pubdate,'n')+'</p><a href="'+data[i].alt+'">豆瓣评分</a></li>'
			}
		    listCon.innerHTML=list;
		}else{
			listCon.innerHTML='';
			alert('没有找到相关歌曲?_?');
		}
	}
	oBtn.onclick=function(){
		var con=document.querySelector('#search').value;
		var oA=document.createElement('script');
		oA.src=' https://api.douban.com/v2/music/search?q='+con+'&callback=mInfo';
		document.body.appendChild(oA);
		document.body.removeChild(oA);
	}
</script>
</html>
